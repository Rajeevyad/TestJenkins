node
{
	stage('Docker Push')
	try
	{
		echo "TAGGING IMAGES"
		echo "${env.BUILD_NUMBER}"
		bat  "docker tag testjenkins:latest images.tooling.lm-core-platform.com:443/lmproptreatypro/testjenkins:${env.BUILD_NUMBER}"

		withCredentials([usernamePassword(credentialsId: 'Docker_Nexus_Credentials', passwordVariable: 'Docker_Nexus_CredentialsPassword', usernameVariable: 'Docker_Nexus_CredentialsUser')]) 
		{
          bat "docker login -u ${env.Docker_Hub_CredentialsUser} -p ${env.Docker_Hub_CredentialsPassword}  https://images.tooling.lm-core-platform.com:443"           
        }

		withDockerRegistry([credentialsId: 'Docker_Nexus_Credentials', url: 'https://images.tooling.lm-core-platform.com:443']) 
		{
 			bat "docker push images.tooling.lm-core-platform.com:443/lmproptreatypro/testjenkins:${env.BUILD_NUMBER}"
			bat "docker logout https://images.tooling.lm-core-platform.com:443"
		}

     }
	 catch (err) {
        echo "Caught: ${err}"
        currentBuild.result = 'FAILURE'
    }
    
    notify('BUILD SUCCESSFUL')     
}


def notify(status)
{
    node
    {
     echo "BuildNumber: ${BUILD_NUMBER} ----JOB NAME: ${JOB_NAME}"
    }
}
