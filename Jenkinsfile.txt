node
{
    stage 'GitHub'
	def app
    try 
    {
        echo 'Getting data from Github.........'
        git 'https://github.com/Rajeevyad/TestJenkins.git'
      
    } catch (err) {
        echo "Caught: ${err}"
        currentBuild.result = 'FAILURE'
    }
        
    stage 'Docker Build'
         powershell '.\\dockercompose.ps1'

	stage('Docker Push')
	try
	{
		echo "TAGGING IMAGES"
		bat 'docker tag testjenkins:latest images.tooling.lm-core-platform.com:443/lmproptreatypro/testjenkins:"${BUILD_NUMBER}"'

        withDockerRegistry([credentialsId: 'Docker_Nexus_Credentials', url: 'https://images.tooling.lm-core-platform.com:443']) 
		{
 			bat 'docker push images.tooling.lm-core-platform.com:443/lmproptreatypro/testjenkins:${BUILD_NUMBER}'
		}
     }
	 catch (err) {
        echo "Caught: ${err}"
        currentBuild.result = 'FAILURE'
    }
    
    notify('BUILD SUCCESSFUL')     
}


def notify(status)
{
    node
    {
     echo "BuildNumber: ${BUILD_NUMBER} ----JOB NAME: ${JOB_NAME}"
    }
}
